!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FxAccountClient=t():e.FxAccountClient=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=4)}([function(e,t){var r,n;r=[],void 0!==(n=function(){"use strict";function t(e,t,r){if(4!==t.length)throw new n.exception.invalid("invalid aes block size");var o=e.e[r],s=t[0]^o[0],i=t[r?3:1]^o[1],u=t[2]^o[2];t=t[r?1:3]^o[3];var c,a,h,f,l=o.length/4-2,p=4,d=[0,0,0,0];c=e.b[r],e=c[0];var m=c[1],v=c[2],y=c[3],g=c[4];for(f=0;l>f;f++)c=e[s>>>24]^m[i>>16&255]^v[u>>8&255]^y[255&t]^o[p],a=e[i>>>24]^m[u>>16&255]^v[t>>8&255]^y[255&s]^o[p+1],h=e[u>>>24]^m[t>>16&255]^v[s>>8&255]^y[255&i]^o[p+2],t=e[t>>>24]^m[s>>16&255]^v[i>>8&255]^y[255&u]^o[p+3],p+=4,s=c,i=a,u=h;for(f=0;4>f;f++)d[r?3&-f:f]=g[s>>>24]<<24^g[i>>16&255]<<16^g[u>>8&255]<<8^g[255&t]^o[p++],c=s,s=i,i=u,u=t,t=c;return d}function r(e,t){var r,n,o,s=t.slice(0),i=e.f,u=e.e,c=i[0],a=i[1],h=i[2],f=i[3],l=i[4],p=i[5],d=i[6],m=i[7];for(r=0;64>r;r++)16>r?n=s[r]:(n=s[r+1&15],o=s[r+14&15],n=s[15&r]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+s[15&r]+s[r+9&15]|0),n=n+m+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(d^l&(p^d))+u[r],m=d,d=p,p=l,l=f+n|0,f=h,h=a,a=c,c=n+(a&h^f&(a^h))+(a>>>2^a>>>13^a>>>22^a<<30^a<<19^a<<10)|0;i[0]=i[0]+c|0,i[1]=i[1]+a|0,i[2]=i[2]+h|0,i[3]=i[3]+f|0,i[4]=i[4]+l|0,i[5]=i[5]+p|0,i[6]=i[6]+d|0,i[7]=i[7]+m|0}var n={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};return void 0!==e&&e.exports&&(e.exports=n),n.cipher.aes=function(e){this.b[0][0][0]||this.g();var t,r,o,s,i=this.b[0][4],u=this.b[1];t=e.length;var c=1;if(4!==t&&6!==t&&8!==t)throw new n.exception.invalid("invalid aes key size");for(this.e=[o=e.slice(0),s=[]],e=t;4*t+28>e;e++)r=o[e-1],(0==e%t||8===t&&4==e%t)&&(r=i[r>>>24]<<24^i[r>>16&255]<<16^i[r>>8&255]<<8^i[255&r],0==e%t&&(r=r<<8^r>>>24^c<<24,c=c<<1^283*(c>>7))),o[e]=o[e-t]^r;for(t=0;e;t++,e--)r=o[3&t?e:e-4],s[t]=4>=e||4>t?r:u[0][i[r>>>24]]^u[1][i[r>>16&255]]^u[2][i[r>>8&255]]^u[3][i[255&r]]},n.cipher.aes.prototype={encrypt:function(e){return t(this,e,0)},decrypt:function(e){return t(this,e,1)},b:[[[],[],[],[],[]],[[],[],[],[],[]]],g:function(){var e,t,r,n,o,s,i,u=this.b[0],c=this.b[1],a=u[4],h=c[4],f=[],l=[];for(e=0;256>e;e++)l[(f[e]=e<<1^283*(e>>7))^e]=e;for(t=r=0;!a[t];t^=n||1,r=l[r]||1)for(s=r^r<<1^r<<2^r<<3^r<<4,s=s>>8^255&s^99,a[t]=s,h[s]=t,o=f[e=f[n=f[t]]],i=16843009*o^65537*e^257*n^16843008*t,o=257*f[s]^16843008*s,e=0;4>e;e++)u[e][t]=o=o<<24^o>>>8,c[e][s]=i=i<<24^i>>>8;for(e=0;5>e;e++)u[e]=u[e].slice(0),c[e]=c[e].slice(0)}},n.bitArray={bitSlice:function(e,t,r){return e=n.bitArray.l(e.slice(t/32),32-(31&t)).slice(1),void 0===r?e:n.bitArray.clamp(e,r-t)},extract:function(e,t,r){var n=Math.floor(-t-r&31);return(-32&(t+r-1^t)?e[t/32|0]<<32-n^e[t/32+1|0]>>>n:e[t/32|0]>>>n)&(1<<r)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var r=e[e.length-1],o=n.bitArray.getPartial(r);return 32===o?e.concat(t):n.bitArray.l(t,o,0|r,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+n.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(t>32*e.length)return e;e=e.slice(0,Math.ceil(t/32));var r=e.length;return t&=31,r>0&&t&&(e[r-1]=n.bitArray.partial(t,e[r-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return 32===e?t:(r?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(n.bitArray.bitLength(e)!==n.bitArray.bitLength(t))return!1;var r,o=0;for(r=0;e.length>r;r++)o|=e[r]^t[r];return 0===o},l:function(e,t,r,o){var s;for(s=0,void 0===o&&(o=[]);t>=32;t-=32)o.push(r),r=0;if(0===t)return o.concat(e);for(s=0;e.length>s;s++)o.push(r|e[s]>>>t),r=e[s]<<32-t;return s=e.length?e[e.length-1]:0,e=n.bitArray.getPartial(s),o.push(n.bitArray.partial(t+e&31,t+e>32?r:o.pop(),1)),o},n:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},n.codec.utf8String={fromBits:function(e){var t,r,o="",s=n.bitArray.bitLength(e);for(t=0;s/8>t;t++)0==(3&t)&&(r=e[t/4]),o+=String.fromCharCode(r>>>24),r<<=8;return decodeURIComponent(escape(o))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,r=[],o=0;for(t=0;e.length>t;t++)o=o<<8|e.charCodeAt(t),3==(3&t)&&(r.push(o),o=0);return 3&t&&r.push(n.bitArray.partial(8*(3&t),o)),r}},n.codec.hex={fromBits:function(e){var t,r="";for(t=0;e.length>t;t++)r+=(0xf00000000000+(0|e[t])).toString(16).substr(4);return r.substr(0,n.bitArray.bitLength(e)/4)},toBits:function(e){var t,r,o=[];for(e=e.replace(/\s|0x/g,""),r=e.length,e+="00000000",t=0;e.length>t;t+=8)o.push(0^parseInt(e.substr(t,8),16));return n.bitArray.clamp(o,4*r)}},n.codec.base64={i:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,r){var o="",s=0,i=n.codec.base64.i,u=0,c=n.bitArray.bitLength(e);for(r&&(i=i.substr(0,62)+"-_"),r=0;c>6*o.length;)o+=i.charAt((u^e[r]>>>s)>>>26),6>s?(u=e[r]<<6-s,s+=26,r++):(u<<=6,s-=6);for(;3&o.length&&!t;)o+="=";return o},toBits:function(e,t){e=e.replace(/\s|=/g,"");var r,o,s=[],i=0,u=n.codec.base64.i,c=0;for(t&&(u=u.substr(0,62)+"-_"),r=0;e.length>r;r++){if(0>(o=u.indexOf(e.charAt(r))))throw new n.exception.invalid("this isn't base64!");i>26?(i-=26,s.push(c^o>>>i),c=o<<32-i):(i+=6,c^=o<<32-i)}return 56&i&&s.push(n.bitArray.partial(56&i,c,1)),s}},n.codec.base64url={fromBits:function(e){return n.codec.base64.fromBits(e,1,1)},toBits:function(e){return n.codec.base64.toBits(e,1)}},n.hash.sha256=function(e){this.e[0]||this.g(),e?(this.f=e.f.slice(0),this.d=e.d.slice(0),this.a=e.a):this.reset()},n.hash.sha256.hash=function(e){return(new n.hash.sha256).update(e).finalize()},n.hash.sha256.prototype={blockSize:512,reset:function(){return this.f=this.k.slice(0),this.d=[],this.a=0,this},update:function(e){"string"==typeof e&&(e=n.codec.utf8String.toBits(e));var t,o=this.d=n.bitArray.concat(this.d,e);for(t=this.a,e=this.a=t+n.bitArray.bitLength(e),t=512+t&-512;e>=t;t+=512)r(this,o.splice(0,16));return this},finalize:function(){var e,t=this.d,o=this.f,t=n.bitArray.concat(t,[n.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.a/4294967296)),t.push(0|this.a);t.length;)r(this,t.splice(0,16));return this.reset(),o},k:[],e:[],g:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}var t,r=0,n=2;e:for(;64>r;n++){for(t=2;n>=t*t;t++)if(0==n%t)continue e;8>r&&(this.k[r]=e(Math.pow(n,.5))),this.e[r]=e(Math.pow(n,1/3)),r++}}},n.misc.hmac=function(e,t){this.j=t=t||n.hash.sha256;var r,o=[[],[]],s=t.prototype.blockSize/32;for(this.c=[new t,new t],e.length>s&&(e=t.hash(e)),r=0;s>r;r++)o[0][r]=909522486^e[r],o[1][r]=1549556828^e[r];this.c[0].update(o[0]),this.c[1].update(o[1]),this.h=new t(this.c[0])},n.misc.hmac.prototype.encrypt=n.misc.hmac.prototype.mac=function(e){if(this.m)throw new n.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)},n.misc.hmac.prototype.reset=function(){this.h=new this.j(this.c[0]),this.m=!1},n.misc.hmac.prototype.update=function(e){this.m=!0,this.h.update(e)},n.misc.hmac.prototype.digest=function(){var e=this.h.finalize(),e=new this.j(this.c[1]).update(e).finalize();return this.reset(),e},n.misc.pbkdf2=function(e,t,r,o,s){if(r=r||1e3,0>o||0>r)throw n.exception.invalid("invalid params to pbkdf2");"string"==typeof e&&(e=n.codec.utf8String.toBits(e)),"string"==typeof t&&(t=n.codec.utf8String.toBits(t)),s=s||n.misc.hmac,e=new s(e);var i,u,c,a,h=[],f=n.bitArray;for(a=1;(o||1)>32*h.length;a++){for(s=i=e.encrypt(f.concat(t,[a])),u=1;r>u;u++)for(i=e.encrypt(i),c=0;i.length>c;c++)s[c]^=i[c];h=h.concat(s)}return o&&(h=f.clamp(h,o)),h},n}.apply(t,r))&&(e.exports=n)},function(e,t,r){var n,o;n=[r(9),r(2)],void 0!==(o=function(e,t){"use strict";function r(e,t,r){r||(r={}),this.baseUri=e,this._localtimeOffsetMsec=r.localtimeOffsetMsec,this.xhr=t||XMLHttpRequest,this.timeout=r.timeout||3e4}return r.prototype.send=function(r,n,o,s,i){var u=new this.xhr,c=this.baseUri+r,a=null,h=this;i=i||{},s&&(a=JSON.stringify(s));try{u.open(n,c)}catch(e){return Promise.reject({error:"Unknown error",message:""+e,errno:999})}return new Promise(function(f,l){if(u.timeout=h.timeout,u.onreadystatechange=function(){if(4===u.readyState){var e=u.responseText;try{e=JSON.parse(u.responseText)}catch(e){}if(e.errno){if(e.errno!==t.INVALID_TIMESTAMP||i.retrying)return l(e);return h._localtimeOffsetMsec=1e3*e.serverTime-(new Date).getTime(),i.retrying=!0,h.send(r,n,o,s,i).then(f,l)}if(void 0===u.status||200!==u.status)return l(0===e.length?{error:"Timeout error",errno:999}:{error:"Unknown error",message:e,errno:999,code:u.status});f(e)}},o){var p=e.client.header(c,n,{credentials:o,payload:a,contentType:"application/json",localtimeOffsetMsec:h._localtimeOffsetMsec||0});u.setRequestHeader("authorization",p.field)}if(u.setRequestHeader("Content-Type","application/json"),i&&i.headers)for(var d in i.headers)u.setRequestHeader(d,i.headers[d]);u.send(a)})},r}.apply(t,n))&&(e.exports=o)},function(e,t){var r,n;r=[],void 0!==(n=function(){return{INVALID_TIMESTAMP:111,INCORRECT_EMAIL_CASE:120}}.apply(t,r))&&(e.exports=n)},function(e,t,r){var n,o;n=[r(0)],void 0!==(o=function(e){"use strict";function t(t,r,n,o){var s=new e.misc.hmac(n,e.hash.sha256);s.update(t);for(var i=s.digest(),u=Math.ceil(o/32),c=e.codec.hex.toBits(""),a="",h=0;u>h;h++){var f=new e.misc.hmac(i,e.hash.sha256);f.update(e.bitArray.concat(e.bitArray.concat(c,r),e.codec.utf8String.toBits(String.fromCharCode(h+1)))),c=f.digest(),a+=e.codec.hex.fromBits(c)}var l=e.bitArray.clamp(e.codec.hex.toBits(a),8*o);return Promise.resolve(l)}return t}.apply(t,n))&&(e.exports=o)},function(e,t,r){var n,o;n=[r(5),r(0),r(8),r(2),r(11),r(12),r(1)],void 0!==(o=function(e,t,r,n,o,s,i){"use strict";function u(e){return void 0===e}function c(e){return null===e}function a(e){return"[object Object]"===Object.prototype.toString.call(e)&&!Object.keys(e).length}function h(e){return""===e}function f(e,t){if(u(e)||c(e)||a(e)||h(e))throw Error("Missing "+t)}function l(e,t){if(!e&&!t)throw Error("Firefox Accounts auth server endpoint or configuration object required.");if("string"!=typeof e&&(t=e||{},e=t.uri),void 0===t&&(t={}),!e)throw Error("FxA auth server uri not set.");m.test(e)||(e=e+"/"+d),this.request=new i(e,t.xhr,{localtimeOffsetMsec:t.localtimeOffsetMsec})}function p(e){f(e,"credentials"),f(e.oldUnwrapBKey,"credentials.oldUnwrapBKey"),f(e.keyFetchToken,"credentials.keyFetchToken"),f(e.passwordChangeToken,"credentials.passwordChangeToken")}e.polyfill();var d="v1",m=RegExp("/"+d+"$");return l.VERSION=d,l.prototype.signUp=function(e,n,o){var i=this;return Promise.resolve().then(function(){return f(e,"email"),f(n,"password"),r.setup(e,n)}).then(function(e){var r="/account/create",n={email:e.emailUTF8,authPW:t.codec.hex.fromBits(e.authPW)},u={};return o&&(o.service&&(n.service=o.service),o.redirectTo&&(n.redirectTo=o.redirectTo),o.preVerified&&(n.preVerified=o.preVerified),o.resume&&(n.resume=o.resume),o.keys&&(r+="?keys=true"),o.lang&&(u.headers={"Accept-Language":o.lang}),o.metricsContext&&(n.metricsContext=s.marshall(o.metricsContext))),i.request.send(r,"POST",null,n,u).then(function(r){return o&&o.keys&&(r.unwrapBKey=t.codec.hex.fromBits(e.unwrapBKey)),r})})},l.prototype.signIn=function(e,o,i){var u=this;return i=i||{},Promise.resolve().then(function(){return f(e,"email"),f(o,"password"),r.setup(e,o)}).then(function(r){var c="/account/login";i.keys&&(c+="?keys=true");var a={email:r.emailUTF8,authPW:t.codec.hex.fromBits(r.authPW)};return i.metricsContext&&(a.metricsContext=s.marshall(i.metricsContext)),i.reason&&(a.reason=i.reason),i.redirectTo&&(a.redirectTo=i.redirectTo),i.resume&&(a.resume=i.resume),i.service&&(a.service=i.service),i.unblockCode&&(a.unblockCode=i.unblockCode),i.originalLoginEmail&&(a.originalLoginEmail=i.originalLoginEmail),i.verificationMethod&&(a.verificationMethod=i.verificationMethod),u.request.send(c,"POST",null,a).then(function(e){return i.keys&&(e.unwrapBKey=t.codec.hex.fromBits(r.unwrapBKey)),e},function(t){if(t&&t.email&&t.errno===n.INCORRECT_EMAIL_CASE&&!i.skipCaseError)return i.skipCaseError=!0,i.originalLoginEmail=e,u.signIn(t.email,o,i);throw t})})},l.prototype.verifyCode=function(e,t,r){var n=this;return Promise.resolve().then(function(){f(e,"uid"),f(t,"verify code");var o={uid:e,code:t};return r&&(r.service&&(o.service=r.service),r.reminder&&(o.reminder=r.reminder),r.type&&(o.type=r.type),r.marketingOptIn&&(o.marketingOptIn=!0)),n.request.send("/recovery_email/verify_code","POST",null,o)})},l.prototype.verifyTokenCode=function(e,t,r){var n=this;return f(t,"uid"),f(r,"verify token code"),f(e,"sessionToken"),Promise.resolve().then(function(){return o(e,"sessionToken",64)}).then(function(e){return n.request.send("/session/verify/token","POST",e,{uid:t,code:r})})},l.prototype.recoveryEmailStatus=function(e){var t=this;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.request.send("/recovery_email/status","GET",e)})},l.prototype.recoveryEmailResendCode=function(e,t){var r=this,n={},s={};return Promise.resolve().then(function(){return f(e,"sessionToken"),t&&(t.email&&(n.email=t.email),t.service&&(n.service=t.service),t.redirectTo&&(n.redirectTo=t.redirectTo),t.resume&&(n.resume=t.resume),t.type&&(n.type=t.type),t.lang&&(s.headers={"Accept-Language":t.lang})),o(e,"sessionToken",64)}).then(function(e){return r.request.send("/recovery_email/resend_code","POST",e,n,s)})},l.prototype.passwordForgotSendCode=function(e,t){var r=this,n={email:e},o={};return Promise.resolve().then(function(){return f(e,"email"),t&&(t.service&&(n.service=t.service),t.redirectTo&&(n.redirectTo=t.redirectTo),t.resume&&(n.resume=t.resume),t.lang&&(o.headers={"Accept-Language":t.lang}),t.metricsContext&&(n.metricsContext=s.marshall(t.metricsContext))),r.request.send("/password/forgot/send_code","POST",null,n,o)})},l.prototype.passwordForgotResendCode=function(e,t,r){var n=this,i={email:e},u={};return Promise.resolve().then(function(){return f(e,"email"),f(t,"passwordForgotToken"),r&&(r.service&&(i.service=r.service),r.redirectTo&&(i.redirectTo=r.redirectTo),r.resume&&(i.resume=r.resume),r.lang&&(u.headers={"Accept-Language":r.lang}),r.metricsContext&&(i.metricsContext=s.marshall(r.metricsContext))),o(t,"passwordForgotToken",64)}).then(function(e){return n.request.send("/password/forgot/resend_code","POST",e,i,u)})},l.prototype.passwordForgotVerifyCode=function(e,t,r){var n=this;return Promise.resolve().then(function(){return f(e,"reset code"),f(t,"passwordForgotToken"),o(t,"passwordForgotToken",64)}).then(function(t){var o={code:e};return r&&r.metricsContext&&(o.metricsContext=s.marshall(r.metricsContext)),n.request.send("/password/forgot/verify_code","POST",t,o)})},l.prototype.passwordForgotStatus=function(e){var t=this;return Promise.resolve().then(function(){return f(e,"passwordForgotToken"),o(e,"passwordForgotToken",64)}).then(function(e){return t.request.send("/password/forgot/status","GET",e)})},l.prototype.accountReset=function(e,n,i,u){var c,a=this,h={};return u=u||{},u.sessionToken&&(h.sessionToken=u.sessionToken),u.metricsContext&&(h.metricsContext=s.marshall(u.metricsContext)),Promise.resolve().then(function(){return f(e,"email"),f(n,"new password"),f(i,"accountResetToken"),u.keys&&f(u.sessionToken,"sessionToken"),r.setup(e,n)}).then(function(e){return u.keys&&(c=t.codec.hex.fromBits(e.unwrapBKey)),h.authPW=t.codec.hex.fromBits(e.authPW),o(i,"accountResetToken",64)}).then(function(e){var t="";return u.keys&&(t="?keys=true"),a.request.send("/account/reset"+t,"POST",e,h).then(function(e){return u.keys&&e.keyFetchToken&&(e.unwrapBKey=c),e})})},l.prototype.accountKeys=function(e,n){var s=this;return Promise.resolve().then(function(){return f(e,"keyFetchToken"),f(n,"oldUnwrapBKey"),o(e,"keyFetchToken",96)}).then(function(e){var n=t.codec.hex.fromBits(e.bundleKey);return s.request.send("/account/keys","GET",e).then(function(e){return r.unbundleKeyFetchResponse(n,e.bundle)})}).then(function(e){return{kB:t.codec.hex.fromBits(r.xor(t.codec.hex.toBits(e.wrapKB),t.codec.hex.toBits(n))),kA:e.kA}})},l.prototype.accountDestroy=function(e,s,i,u){var c=this;return i=i||{},Promise.resolve().then(function(){f(e,"email"),f(s,"password");var t=[r.setup(e,s)];return u&&t.push(o(u,"sessionToken",64)),Promise.all(t)}).then(function(e){var r=e[0],o=e[1],a={email:r.emailUTF8,authPW:t.codec.hex.fromBits(r.authPW)};return c.request.send("/account/destroy","POST",o,a).then(function(e){return e},function(e){if(e&&e.email&&e.errno===n.INCORRECT_EMAIL_CASE&&!i.skipCaseError)return i.skipCaseError=!0,c.accountDestroy(e.email,s,i,u);throw e})})},l.prototype.accountStatus=function(e){var t=this;return Promise.resolve().then(function(){return f(e,"uid"),t.request.send("/account/status?uid="+e,"GET")})},l.prototype.accountStatusByEmail=function(e){var t=this;return Promise.resolve().then(function(){return f(e,"email"),t.request.send("/account/status","POST",null,{email:e})})},l.prototype.sessionDestroy=function(e,t){var r=this,n={};return t=t||{},t.customSessionToken&&(n.customSessionToken=t.customSessionToken),Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return r.request.send("/session/destroy","POST",e,n)})},l.prototype.sessionStatus=function(e){var t=this;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.request.send("/session/status","GET",e)})},l.prototype.sessionReauth=function(e,i,u,c){var a=this;return c=c||{},Promise.resolve().then(function(){return f(e,"sessionToken"),f(i,"email"),f(u,"password"),r.setup(i,u)}).then(function(r){var h="/session/reauth";c.keys&&(h+="?keys=true");var f={email:r.emailUTF8,authPW:t.codec.hex.fromBits(r.authPW)};return c.metricsContext&&(f.metricsContext=s.marshall(c.metricsContext)),c.reason&&(f.reason=c.reason),c.redirectTo&&(f.redirectTo=c.redirectTo),c.resume&&(f.resume=c.resume),c.service&&(f.service=c.service),c.unblockCode&&(f.unblockCode=c.unblockCode),c.originalLoginEmail&&(f.originalLoginEmail=c.originalLoginEmail),c.verificationMethod&&(f.verificationMethod=c.verificationMethod),o(e,"sessionToken",64).then(function(e){return a.request.send(h,"POST",e,f)}).then(function(e){return c.keys&&(e.unwrapBKey=t.codec.hex.fromBits(r.unwrapBKey)),e},function(t){if(t&&t.email&&t.errno===n.INCORRECT_EMAIL_CASE&&!c.skipCaseError)return c.skipCaseError=!0,c.originalLoginEmail=i,a.sessionReauth(e,t.email,u,c);throw t})})},l.prototype.certificateSign=function(e,t,r,n){var s=this,i={publicKey:t,duration:r};return Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"publicKey"),f(r,"duration"),o(e,"sessionToken",64)}).then(function(e){n=n||{};var t="";return n.service&&(t="?service="+encodeURIComponent(n.service)),s.request.send("/certificate/sign"+t,"POST",e,i)})},l.prototype.passwordChange=function(e,t,r,n){var o=this;return n=n||{},Promise.resolve().then(function(){return f(e,"email"),f(t,"old password"),f(r,"new password"),o._passwordChangeStart(e,t)}).then(function(t){var s=t,i=t.emailToHashWith||e;return o._passwordChangeKeys(s).then(function(e){return o._passwordChangeFinish(i,r,s,e,n)})})},l.prototype._passwordChangeStart=function(e,o,s){var i=this;return s=s||{},Promise.resolve().then(function(){return f(e,"email"),f(o,"old password"),r.setup(e,o)}).then(function(r){var u={email:r.emailUTF8,oldAuthPW:t.codec.hex.fromBits(r.authPW)};return i.request.send("/password/change/start","POST",null,u).then(function(n){return n.oldUnwrapBKey=t.codec.hex.fromBits(r.unwrapBKey),n.emailToHashWith=e,n},function(e){if(e&&e.email&&e.errno===n.INCORRECT_EMAIL_CASE&&!s.skipCaseError)return s.skipCaseError=!0,i._passwordChangeStart(e.email,o,s);throw e})})},l.prototype._passwordChangeKeys=function(e){var t=this;return Promise.resolve().then(function(){p(e)}).then(function(){return t.accountKeys(e.keyFetchToken,e.oldUnwrapBKey)})},l.prototype._passwordChangeFinish=function(e,n,s,i,u){u=u||{};var c=this;return Promise.resolve().then(function(){f(e,"email"),f(n,"new password"),p(s),f(i,"keys"),f(i.kB,"keys.kB");var t=[];return t.push(r.setup(e,n)),t.push(o(s.passwordChangeToken,"passwordChangeToken",64)),u.sessionToken&&t.push(o(u.sessionToken,"sessionToken",64)),Promise.all(t)}).then(function(e){var n=e[0],o=e[1],s=e[2],a=t.codec.hex.fromBits(r.xor(t.codec.hex.toBits(i.kB),n.unwrapBKey)),h="";u.keys&&(h="?keys=true");var f;return s&&s.id&&(f=s.id),c.request.send("/password/change/finish"+h,"POST",o,{wrapKb:a,authPW:t.codec.hex.fromBits(n.authPW),sessionToken:f}).then(function(e){return u.keys&&e.keyFetchToken&&(e.unwrapBKey=t.codec.hex.fromBits(n.unwrapBKey)),e})})},l.prototype.getRandomBytes=function(){return this.request.send("/get_random_bytes","POST")},l.prototype.deviceRegister=function(e,t,r,n){var s=this.request;return n=n||{},Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"deviceName"),f(r,"deviceType"),o(e,"sessionToken",64)}).then(function(e){var o={name:t,type:r};return n.deviceCallback&&(o.pushCallback=n.deviceCallback),n.devicePublicKey&&n.deviceAuthKey&&(o.pushPublicKey=n.devicePublicKey,o.pushAuthKey=n.deviceAuthKey),s.send("/account/device","POST",e,o)})},l.prototype.deviceUpdate=function(e,t,r,n){var s=this.request;return n=n||{},Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"deviceId"),f(r,"deviceName"),o(e,"sessionToken",64)}).then(function(e){var o={id:t,name:r};return n.deviceCallback&&(o.pushCallback=n.deviceCallback),n.devicePublicKey&&n.deviceAuthKey&&(o.pushPublicKey=n.devicePublicKey,o.pushAuthKey=n.deviceAuthKey),s.send("/account/device","POST",e,o)})},l.prototype.deviceDestroy=function(e,t){var r=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"deviceId"),o(e,"sessionToken",64)}).then(function(e){return r.send("/account/device/destroy","POST",e,{id:t})})},l.prototype.deviceList=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/account/devices","GET",e)})},l.prototype.sessions=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/account/sessions","GET",e)})},l.prototype.sendUnblockCode=function(e,t){var r=this;return Promise.resolve().then(function(){f(e,"email");var n={email:e};return t&&t.metricsContext&&(n.metricsContext=s.marshall(t.metricsContext)),r.request.send("/account/login/send_unblock_code","POST",null,n)})},l.prototype.rejectUnblockCode=function(e,t){var r=this;return Promise.resolve().then(function(){return f(e,"uid"),f(t,"unblockCode"),r.request.send("/account/login/reject_unblock_code","POST",null,{uid:e,unblockCode:t})})},l.prototype.sendSms=function(e,t,r,n){var i=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"phoneNumber"),f(r,"messageId"),o(e,"sessionToken",64)}).then(function(e){var o={phoneNumber:t,messageId:r},u={};return n&&(n.lang&&(u.headers={"Accept-Language":n.lang}),n.features&&(o.features=n.features),n.metricsContext&&(o.metricsContext=s.marshall(n.metricsContext))),i.send("/sms","POST",e,o,u)})},l.prototype.smsStatus=function(e,t){var r=this.request;return t=t||{},Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){var n="/sms/status";return t.country&&(n+="?country="+encodeURIComponent(t.country)),r.send(n,"GET",e)})},l.prototype.consumeSigninCode=function(e,t,r,n){var o=this;return Promise.resolve().then(function(){return f(e,"code"),f(t,"flowId"),f(r,"flowBeginTime"),o.request.send("/signinCodes/consume","POST",null,{code:e,metricsContext:{deviceId:n,flowId:t,flowBeginTime:r}})})},l.prototype.recoveryEmails=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/recovery_emails","GET",e)})},l.prototype.recoveryEmailCreate=function(e,t){var r=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(e,"email"),o(e,"sessionToken",64)}).then(function(e){return r.send("/recovery_email","POST",e,{email:t})})},l.prototype.recoveryEmailDestroy=function(e,t){var r=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(e,"email"),o(e,"sessionToken",64)}).then(function(e){return r.send("/recovery_email/destroy","POST",e,{email:t})})},l.prototype.recoveryEmailSetPrimaryEmail=function(e,t){var r=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return r.send("/recovery_email/set_primary","POST",e,{email:t})})},l.prototype.createTotpToken=function(e,t){var r=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){var n={};return t&&t.metricsContext&&(n.metricsContext=s.marshall(t.metricsContext)),r.send("/totp/create","POST",e,n)})},l.prototype.deleteTotpToken=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/totp/destroy","POST",e,{})})},l.prototype.checkTotpTokenExists=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/totp/exists","GET",e)})},l.prototype.verifyTotpCode=function(e,t,r){var n=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"code"),o(e,"sessionToken",64)}).then(function(e){var o={code:t};return r&&r.service&&(o.service=r.service),r&&r.metricsContext&&(o.metricsContext=s.marshall(r.metricsContext)),n.send("/session/verify/totp","POST",e,o)})},l.prototype.replaceRecoveryCodes=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/recoveryCodes","GET",e)})},l.prototype.consumeRecoveryCode=function(e,t,r){var n=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"code"),o(e,"sessionToken",64)}).then(function(e){var o={code:t};return r&&r.metricsContext&&(o.metricsContext=s.marshall(r.metricsContext)),n.send("/session/verify/recoveryCode","POST",e,o)})},l.prototype.createRecoveryKey=function(e,t,r){var n=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),f(t,"recoveryKeyId"),f(r,"bundle"),o(e,"sessionToken",64)}).then(function(e){return n.send("/recoveryKey","POST",e,{recoveryKeyId:t,recoveryData:r})})},l.prototype.getRecoveryKey=function(e,t){var r=this.request;return Promise.resolve().then(function(){return f(e,"accountResetToken"),f(t,"recoveryKeyId"),o(e,"accountResetToken",64)}).then(function(e){return r.send("/recoveryKey/"+t,"GET",e)})},l.prototype.resetPasswordWithRecoveryKey=function(e,n,i,u,c,a){a=a||{};var h=this.request;return Promise.resolve().then(function(){f(n,"email"),f(i,"new password"),f(c,"keys"),f(c.kB,"keys.kB"),f(e,"accountResetToken"),f(u,"recoveryKeyId");var t=[];return t.push(r.setup(n,i)),t.push(o(e,"accountResetToken",64)),Promise.all(t)}).then(function(e){var n=e[0],o=e[1],i=t.codec.hex.fromBits(r.xor(t.codec.hex.toBits(c.kB),n.unwrapBKey)),l={wrapKb:i,authPW:t.codec.hex.fromBits(n.authPW),recoveryKeyId:u};a.sessionToken&&(l.sessionToken=a.sessionToken),a.keys&&f(a.sessionToken,"sessionToken"),a.metricsContext&&(l.metricsContext=s.marshall(a.metricsContext));var p="";return a.keys&&(p="?keys=true"),h.send("/account/reset"+p,"POST",o,l).then(function(e){return a.keys&&e.keyFetchToken&&(e.unwrapBKey=t.codec.hex.fromBits(n.unwrapBKey)),e})})},l.prototype.deleteRecoveryKey=function(e){var t=this.request;return Promise.resolve().then(function(){return f(e,"sessionToken"),o(e,"sessionToken",64)}).then(function(e){return t.send("/recoveryKey","DELETE",e,{})})},l.prototype.recoveryKeyExists=function(e,t){var r=this.request;return Promise.resolve().then(function(){return e?o(e,"sessionToken",64).then(function(e){return r.send("/recoveryKey/exists","POST",e,{})}):r.send("/recoveryKey/exists","POST",null,{email:t})})},l.prototype._required=f,l}.apply(t,n))&&(e.exports=o)},function(e,t,r){(function(t){!function(t,r){e.exports=r()}(0,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function o(e){z=e}function s(e){D=e}function i(){return void 0!==H?function(){H(c)}:u()}function u(){var e=setTimeout;return function(){return e(c,1)}}function c(){for(var e=0;W>e;e+=2){(0,X[e])(X[e+1]),X[e]=void 0,X[e+1]=void 0}W=0}function a(e,t){var r=arguments,n=this,o=new this.constructor(f);void 0===o[Z]&&O(o);var s=n._state;return s?function(){var e=r[s-1];D(function(){return S(s,o,e,n._result)})}():x(n,o,e,t),o}function h(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(f);return T(r,e),r}function f(){}function l(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function d(e){try{return e.then}catch(e){return ne.error=e,ne}}function m(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function v(e,t,r){D(function(e){var n=!1,o=m(r,t,function(r){n||(n=!0,t!==r?T(e,r):w(e,r))},function(t){n||(n=!0,b(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&o&&(n=!0,b(e,o))},e)}function y(e,t){t._state===te?w(e,t._result):t._state===re?b(e,t._result):x(t,void 0,function(t){return T(e,t)},function(t){return b(e,t)})}function g(e,t,r){t.constructor===e.constructor&&r===a&&t.constructor.resolve===h?y(e,t):r===ne?(b(e,ne.error),ne.error=null):void 0===r?w(e,t):n(r)?v(e,t,r):w(e,t)}function T(t,r){t===r?b(t,l()):e(r)?g(t,r,d(r)):w(t,r)}function k(e){e._onerror&&e._onerror(e._result),P(e)}function w(e,t){e._state===ee&&(e._result=t,e._state=te,0!==e._subscribers.length&&D(P,e))}function b(e,t){e._state===ee&&(e._state=re,e._result=t,D(k,e))}function x(e,t,r,n){var o=e._subscribers,s=o.length;e._onerror=null,o[s]=t,o[s+te]=r,o[s+re]=n,0===s&&e._state&&D(P,e)}function P(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,s=e._result,i=0;t.length>i;i+=3)n=t[i],o=t[i+r],n?S(r,n,o,s):o(s);e._subscribers.length=0}}function C(){this.error=null}function _(e,t){try{return e(t)}catch(e){return oe.error=e,oe}}function S(e,t,r,o){var s=n(r),i=void 0,u=void 0,c=void 0,a=void 0;if(s){if(i=_(r,o),i===oe?(a=!0,u=i.error,i.error=null):c=!0,t===i)return void b(t,p())}else i=o,c=!0;t._state!==ee||(s&&c?T(t,i):a?b(t,u):e===te?w(t,i):e===re&&b(t,i))}function A(e,t){try{t(function(t){T(e,t)},function(t){b(e,t)})}catch(t){b(e,t)}}function B(){return se++}function O(e){e[Z]=se++,e._state=void 0,e._result=void 0,e._subscribers=[]}function E(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[Z]||O(this.promise),N(t)?(this.length=t.length,this._remaining=t.length,this._result=Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&w(this.promise,this._result))):b(this.promise,K())}function K(){return Error("Array Methods must be provided an Array")}function q(e){return new E(this,e).promise}function M(e){var t=this;return new t(N(e)?function(r,n){for(var o=e.length,s=0;o>s;s++)t.resolve(e[s]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function I(e){var t=this,r=new t(f);return b(r,e),r}function R(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function L(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this[Z]=B(),this._result=this._state=void 0,this._subscribers=[],f!==e&&("function"!=typeof e&&R(),this instanceof F?A(this,e):L())}function j(){var e=void 0;if(void 0!==t)e=t;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw Error("polyfill failed because global object is unavailable in this environment")}var r=e.Promise;if(r){var n=null;try{n=Object.prototype.toString.call(r.resolve())}catch(e){}if("[object Promise]"===n&&!r.cast)return}e.Promise=F}var U=void 0;U=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var N=U,W=0,H=void 0,z=void 0,D=function(e,t){X[W]=e,X[W+1]=t,2===(W+=2)&&(z?z(c):Q())},G="undefined"!=typeof window?window:void 0,V=G||{},Y=V.MutationObserver||V.WebKitMutationObserver,$="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),J="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,X=Array(1e3),Q=void 0;Q=$?function(){return function(){return process.nextTick(c)}}():Y?function(){var e=0,t=new Y(c),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():J?function(){var e=new MessageChannel;return e.port1.onmessage=c,function(){return e.port2.postMessage(0)}}():void 0===G?function(){try{var e=r(7);return H=e.runOnLoop||e.runOnContext,i()}catch(e){return u()}}():u();var Z=Math.random().toString(36).substring(16),ee=void 0,te=1,re=2,ne=new C,oe=new C,se=0;return E.prototype._enumerate=function(e){for(var t=0;this._state===ee&&e.length>t;t++)this._eachEntry(e[t],t)},E.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===h){var o=d(e);if(o===a&&e._state!==ee)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===F){var s=new r(f);g(s,e,o),this._willSettleAt(s,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},E.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===ee&&(this._remaining--,e===re?b(n,r):this._result[t]=r),0===this._remaining&&w(n,this._result)},E.prototype._willSettleAt=function(e,t){var r=this;x(e,void 0,function(e){return r._settledAt(te,t,e)},function(e){return r._settledAt(re,t,e)})},F.all=q,F.race=M,F.resolve=h,F.reject=I,F._setScheduler=o,F._setAsap=s,F._asap=D,F.prototype={constructor:F,then:a,catch:function(e){return this.then(null,e)}},F.polyfill=j,F.Promise=F,F})}).call(t,r(6))},function(e){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(){},function(e,t,r){var n,o;n=[r(1),r(0),r(3),r(10)],void 0!==(o=function(e,t,r,n){"use strict";function o(e){return t.codec.utf8String.toBits(i+e)}function s(e,r){return t.codec.utf8String.toBits(i+e+":"+r)}var i="identity.mozilla.com/picl/v1/",u=t.codec.hex.toBits("00");return{setup:function(e,i){var c={},a=s("quickStretch",e),h=t.codec.utf8String.toBits(i);return c.emailUTF8=e,c.passwordUTF8=i,n.derive(h,a,1e3,256).then(function(e){return c.quickStretchedPW=e,r(e,o("authPW"),u,32).then(function(t){return c.authPW=t,r(e,o("unwrapBkey"),u,32)})}).then(function(e){return c.unwrapBKey=e,c})},xor:function(e,t){for(var r=[],n=0;e.length>n;n++)r[n]=e[n]^t[n];return r},unbundleKeyFetchResponse:function(e,r){var n=this,o=t.codec.hex.toBits(r);return this.deriveBundleKeys(e,"account/keys").then(function(e){var r=t.bitArray.bitSlice(o,0,512),s=t.bitArray.bitSlice(o,-256),i=new t.misc.hmac(e.hmacKey,t.hash.sha256);if(i.update(r),!t.bitArray.equal(i.digest(),s))throw Error("Bad HMac");var u=n.xor(t.bitArray.bitSlice(o,0,512),e.xorKey);return{kA:t.codec.hex.fromBits(t.bitArray.bitSlice(u,0,256)),wrapKB:t.codec.hex.fromBits(t.bitArray.bitSlice(u,256))}})},deriveBundleKeys:function(e,n){var s=o(n),i=t.codec.hex.toBits("");return e=t.codec.hex.toBits(e),r(e,s,i,96).then(function(e){return{hmacKey:t.bitArray.bitSlice(e,0,256),xorKey:t.bitArray.bitSlice(e,256)}})}}}.apply(t,n))&&(e.exports=o)},function(e,t,r){var n,o;n=[r(0)],void 0!==(o=function(e){"use strict";var t={};return t.client={header:function(e,r,n){var o={field:"",artifacts:{}};if(!e||"string"!=typeof e&&"object"!=typeof e||!r||"string"!=typeof r||!n||"object"!=typeof n)return o.err="Invalid argument type",o;var s=n.timestamp||Math.floor((t.utils.now()+(n.localtimeOffsetMsec||0))/1e3),i=n.credentials;if(!(i&&i.id&&i.key&&i.algorithm))return o.err="Invalid credential object",o;if(-1===t.utils.baseIndexOf(t.crypto.algorithms,i.algorithm))return o.err="Unknown algorithm",o;"string"==typeof e&&(e=t.utils.parseUri(e));var u={ts:s,nonce:n.nonce||t.utils.randomString(6),method:r,resource:e.relative,host:e.hostname,port:e.port,hash:n.hash,ext:n.ext,app:n.app,dlg:n.dlg};o.artifacts=u,!u.hash&&n.hasOwnProperty("payload")&&(u.hash=t.crypto.calculatePayloadHash(n.payload,i.algorithm,n.contentType));var c=t.crypto.calculateMac("header",i,u),a=null!==u.ext&&void 0!==u.ext&&""!==u.ext,h='Hawk id="'+i.id+'", ts="'+u.ts+'", nonce="'+u.nonce+(u.hash?'", hash="'+u.hash:"")+(a?'", ext="'+t.utils.escapeHeaderAttribute(u.ext):"")+'", mac="'+c+'"';return u.app&&(h+=', app="'+u.app+(u.dlg?'", dlg="'+u.dlg:"")+'"'),o.field=h,o},authenticate:function(e,r,n,o){if(o=o||{},e.getResponseHeader("www-authenticate")){var s=t.utils.parseAuthorizationHeader(e.getResponseHeader("www-authenticate"),["ts","tsm","error"]);if(!s)return!1;if(s.ts){if(t.crypto.calculateTsMac(s.ts,r)!==s.tsm)return!1;t.utils.setNtpOffset(s.ts-Math.floor((new Date).getTime()/1e3))}}if(!e.getResponseHeader("server-authorization")&&!o.required)return!0;var i=t.utils.parseAuthorizationHeader(e.getResponseHeader("server-authorization"),["mac","ext","hash"]);return!!i&&(t.crypto.calculateMac("response",r,{ts:n.ts,nonce:n.nonce,method:n.method,resource:n.resource,host:n.host,port:n.port,hash:i.hash,ext:i.ext,app:n.app,dlg:n.dlg})===i.mac&&(!o.hasOwnProperty("payload")||!!i.hash&&t.crypto.calculatePayloadHash(o.payload,r.algorithm,e.getResponseHeader("content-type"))===i.hash))},message:function(e,r,n,o){if(!e||"string"!=typeof e||!r||"number"!=typeof r||null===n||void 0===n||"string"!=typeof n||!o||"object"!=typeof o)return null;var s=o.timestamp||Math.floor((t.utils.now()+(o.localtimeOffsetMsec||0))/1e3),i=o.credentials;if(!(i&&i.id&&i.key&&i.algorithm))return null;if(-1===t.crypto.algorithms.indexOf(i.algorithm))return null;var u={ts:s,nonce:o.nonce||t.utils.randomString(6),host:e,port:r,hash:t.crypto.calculatePayloadHash(n,i.algorithm)};return{id:i.id,ts:u.ts,nonce:u.nonce,hash:u.hash,mac:t.crypto.calculateMac("message",i,u)}},authenticateTimestamp:function(e,r,n){return t.crypto.calculateTsMac(e.ts,r)===e.tsm&&(!1!==n&&t.utils.setNtpOffset(e.ts-Math.floor((new Date).getTime()/1e3)),!0)}},t.crypto={headerVersion:"1",algorithms:["sha1","sha256"],calculateMac:function(r,n,o){var s=t.crypto.generateNormalizedString(r,o),i=new e.misc.hmac(n.key,e.hash.sha256);return i.update(s),e.codec.base64.fromBits(i.digest())},generateNormalizedString:function(e,r){var n="hawk."+t.crypto.headerVersion+"."+e+"\n"+r.ts+"\n"+r.nonce+"\n"+(r.method||"").toUpperCase()+"\n"+(r.resource||"")+"\n"+r.host.toLowerCase()+"\n"+r.port+"\n"+(r.hash||"")+"\n";return r.ext&&(n+=r.ext.replace("\\","\\\\").replace("\n","\\n")),n+="\n",r.app&&(n+=r.app+"\n"+(r.dlg||"")+"\n"),n},calculatePayloadHash:function(r,n,o){var s=new e.hash.sha256;return s.update("hawk."+t.crypto.headerVersion+".payload\n").update(t.utils.parseContentType(o)+"\n").update(r||"").update("\n"),e.codec.base64.fromBits(s.finalize())},calculateTsMac:function(r,n){var o=new e.misc.hmac(n.key,e.hash.sha256);return o.update("hawk."+t.crypto.headerVersion+".ts\n"+r+"\n"),e.codec.base64.fromBits(o.digest())}},t.utils={storage:{_cache:{},setItem:function(e,r){t.utils.storage._cache[e]=r},getItem:function(e){return t.utils.storage._cache[e]}},setStorage:function(e){var r=t.utils.getNtpOffset()||0;t.utils.storage=e,t.utils.setNtpOffset(r)},setNtpOffset:function(e){try{t.utils.storage.setItem("hawk_ntp_offset",e)}catch(e){}},getNtpOffset:function(){return parseInt(t.utils.storage.getItem("hawk_ntp_offset")||"0",10)},now:function(){return(new Date).getTime()+t.utils.getNtpOffset()},escapeHeaderAttribute:function(e){return e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},parseContentType:function(e){return e?e.split(";")[0].replace(/^\s+|\s+$/g,"").toLowerCase():""},parseAuthorizationHeader:function(e,t){if(!e)return null;var r=e.match(/^(\w+)(?:\s+(.*))?$/);if(!r)return null;if("hawk"!==r[1].toLowerCase())return null;var n=r[2];if(!n)return null;var o={};return""!==n.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(e,r,n){if(-1!==t.indexOf(r)&&null!==n.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)&&!o.hasOwnProperty(r))return o[r]=n,""})?null:o},randomString:function(e){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r=[],n=0;e>n;++n)r[n]=t[Math.floor(62*Math.random())];return r.join("")},baseIndexOf:function(e,t,r){for(var n=(r||0)-1,o=e?e.length:0;++n<o;)if(e[n]===t)return n;return-1},parseUri:function(e){for(var t=["source","protocol","authority","userInfo","user","password","hostname","port","resource","relative","pathname","directory","file","query","fragment"],r=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?)(?:#(.*))?)/,n=r.exec(e),o={},s=15;s--;)o[t[s]]=n[s]||"";return null!==o.port&&""!==o.port||(o.port="http"===o.protocol.toLowerCase()?"80":"https"===o.protocol.toLowerCase()?"443":""),o}},t}.apply(t,n))&&(e.exports=o)},function(e,t,r){var n,o;n=[r(0)],void 0!==(o=function(e){"use strict";return{derive:function(t,r,n,o){var s=e.misc.pbkdf2(t,r,n,o,e.misc.hmac);return Promise.resolve(s)}}}.apply(t,n))&&(e.exports=o)},function(e,t,r){var n,o;n=[r(0),r(3)],void 0!==(o=function(e,t){"use strict";function r(r,i,u){var c=e.codec.hex.toBits(r),a=e.codec.utf8String.toBits(n+i);return t(c,a,s,u||96).then(function(t){var r=o(t,256,512),n=o(t,512);return{algorithm:"sha256",id:e.codec.hex.fromBits(o(t,0,256)),key:r,bundleKey:n}})}var n="identity.mozilla.com/picl/v1/",o=e.bitArray.bitSlice,s=e.codec.hex.toBits("");return r}.apply(t,n))&&(e.exports=o)},function(e,t){var r,n;r=[],void 0!==(n=function(){"use strict";return{marshall:function(e){return{deviceId:e.deviceId,flowId:e.flowId,flowBeginTime:e.flowBeginTime,utmCampaign:e.utmCampaign,utmContent:e.utmContent,utmMedium:e.utmMedium,utmSource:e.utmSource,utmTerm:e.utmTerm}}}}.apply(t,r))&&(e.exports=n)}])});
//# sourceMappingURL=fxa-client.min.js.map